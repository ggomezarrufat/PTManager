<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Clock</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
</head>
<body>
    <h1>Debug Tournament Clock</h1>
    <div id="status">Inicializando...</div>
    <div id="messages"></div>
    <div id="env-info"></div>

    <script>
        const statusDiv = document.getElementById('status');
        const messagesDiv = document.getElementById('messages');
        const envInfoDiv = document.getElementById('env-info');

        function log(message) {
            console.log(message);
            messagesDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
        }

        // Mostrar informaci√≥n del entorno
        envInfoDiv.innerHTML = `
            <h3>Environment Info:</h3>
            <div>NODE_ENV: ${process?.env?.NODE_ENV || 'undefined'}</div>
            <div>REACT_APP_API_BASE_URL: ${process?.env?.REACT_APP_API_BASE_URL || 'undefined'}</div>
            <div>REACT_APP_API_URL: ${process?.env?.REACT_APP_API_URL || 'undefined'}</div>
        `;

        try {
            log('üöÄ Iniciando debug del reloj del torneo...');

            // Simular la l√≥gica del hook useTournamentClock
            const tournamentId = 'f2c4e932-3b85-4d91-a528-4b5e278fbf9a';
            const userId = 'test-user-' + Date.now();

            log(`üìã Tournament ID: ${tournamentId}`);
            log(`üë§ User ID: ${userId}`);

            // Obtener URL del WebSocket
            let socketUrl = process?.env?.REACT_APP_API_BASE_URL || 'http://localhost:3001';
            if (!socketUrl.startsWith('http')) {
                socketUrl = 'http://localhost:3001';
            }

            log(`üîó Socket URL: ${socketUrl}`);

            statusDiv.textContent = 'Conectando a WebSocket...';
            statusDiv.style.color = 'orange';

            const socket = io(socketUrl);

            socket.on('connect', () => {
                statusDiv.textContent = '‚úÖ WebSocket Conectado';
                statusDiv.style.color = 'green';
                log('‚úÖ WebSocket conectado exitosamente');

                // Unirse al torneo
                log('üì§ Enviando solicitud de uni√≥n al torneo...');
                socket.emit('join-tournament', { tournamentId, userId });

                // Esperar sincronizaci√≥n inicial
                setTimeout(() => {
                    log('‚è∞ Esperando sincronizaci√≥n del reloj...');
                }, 1000);
            });

            socket.on('connect_error', (error) => {
                statusDiv.textContent = '‚ùå Error de conexi√≥n WebSocket';
                statusDiv.style.color = 'red';
                log(`‚ùå Error de conexi√≥n WebSocket: ${error.message}`);
                console.error('Connect error:', error);
            });

            socket.on('disconnect', (reason) => {
                statusDiv.textContent = '‚ùå WebSocket Desconectado';
                statusDiv.style.color = 'red';
                log(`üîå WebSocket desconectado: ${reason}`);
            });

            socket.on('clock-sync', (state) => {
                statusDiv.textContent = '‚úÖ Reloj Sincronizado';
                statusDiv.style.color = 'green';
                log(`üîÑ Sincronizaci√≥n inicial del reloj recibida:`);
                log(JSON.stringify(state, null, 2));
            });

            socket.on('clock-update', (state) => {
                log(`üîÑ Actualizaci√≥n del reloj: ${state.time_remaining_seconds}s`);
            });

            socket.on('error', (error) => {
                log(`‚ùå Error del servidor: ${error.message}`);
                console.error('Server error:', error);
            });

            socket.on('level-changed', (data) => {
                log(`üîÑ Nivel cambiado: ${JSON.stringify(data, null, 2)}`);
            });

            // Timeout para cerrar la conexi√≥n despu√©s de 10 segundos
            setTimeout(() => {
                log('‚è∞ Cerrando conexi√≥n de debug...');
                socket.disconnect();
                statusDiv.textContent = 'Debug completado';
                statusDiv.style.color = 'blue';
            }, 10000);

        } catch (error) {
            statusDiv.textContent = '‚ùå Error al inicializar';
            statusDiv.style.color = 'red';
            log(`‚ùå Error al inicializar: ${error.message}`);
            console.error('Init error:', error);
        }
    </script>
</body>
</html>
